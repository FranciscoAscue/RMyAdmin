library(RMySQL)

## data from MySQL
metadata <- function(db, tabla){
  
  con <- dbConnect(MySQL(),
                   user = 'root',
                   password = 'maq12345',
                   host = 'localhost',
                   dbname = db)
  query = paste0("SELECT * FROM `",tabla,"`;")
  rs = dbSendQuery(con, query);
  df = fetch(rs, -1);
  dbDisconnect(con)
  return(df)
}

metadaquery <- function(placa, corrida){
  
  con <- dbConnect(MySQL(),
                   user = 'root',
                   password = 'maq12345',
                   host = 'localhost',
                   dbname = 'seqcoviddb')
  query = paste0("SELECT NUMERACION_PLACA, NETLAB, OFICIO, REGION, DNI_CE, CT, FECHA_TM, MARCA_PRIMERAS_DOSIS, HOSPITALIZACION  FROM `metadata`  WHERE `PLACA` = '",placa,"' AND `CORRIDA` = ",corrida," ORDER BY `metadata`.`FECHA_TM` DESC;")
  rs = dbSendQuery(con, query);
  df = fetch(rs, -1);
  dbDisconnect(con)
  return(df)
}

metadataOrder <- function(corrida){
  
  con <- dbConnect(MySQL(),
                   user = 'root',
                   password = 'maq12345',
                   host = 'localhost',
                   dbname = 'seqcoviddb') ### cambiar a seqcoviddb
  query = paste0("SELECT * FROM `metadata` WHERE `CORRIDA` = ",corrida," ORDER BY `metadata`.`PLACA` ASC;")
  rs = dbSendQuery(con, query);
  df = fetch(rs, -1);
  dbDisconnect(con)
  return(df)
}

metadataCorr <- function(base_datos,corrida){
  
  con <- dbConnect(MySQL(),
                   user = 'root',
                   password = 'maq12345',
                   host = 'localhost',
                   dbname = 'seqcoviddb')
  query = paste0("SELECT * FROM ",base_datos," WHERE `CORRIDA` = ",corrida,";")
  rs = dbSendQuery(con, query);
  df = fetch(rs, -1);
  dbDisconnect(con)
  return(df)
}

metadataS <- function(base_datos,corrida){
  
  con <- dbConnect(MySQL(),
                   user = 'root',
                   password = 'maq12345',
                   host = 'localhost',
                   dbname = 'SARS_GENOMES')
  query = paste0("SELECT * FROM ",base_datos," WHERE `CORRIDA` = ",corrida,";")
  rs = dbSendQuery(con, query);
  df = fetch(rs, -1);
  dbDisconnect(con)
  return(df)
}

metadataRechazado <- function(oficio){
  
  con <- dbConnect(MySQL(),
                   user = 'root',
                   password = 'maq12345',
                   host = 'localhost',
                   dbname = 'seqcoviddb')
  query = paste0("SELECT NETLAB, OFICIO, PROCEDENCIA, CT, FECHA_TM FROM `metadata` WHERE `OFICIO` LIKE '",oficio,"' AND `CORRIDA` IS NULL ORDER BY `OFICIO` DESC;")
  rs = dbSendQuery(con, query);
  df = fetch(rs, -1);
  dbDisconnect(con)
  return(df)
}


metadataSeq <- function(mindate, maxdate){
  
  con <- dbConnect(MySQL(),
                   user = 'root',
                   password = 'maq12345',
                   host = 'localhost',
                   dbname = 'seqcoviddb')
  query = paste0("SELECT NETLAB, PROCEDENCIA FROM `metadata` WHERE `FECHA_TM` BETWEEN '",mindate,"' AND '",maxdate,"' AND `CORRIDA` IS NOT NULL ORDER BY `metadata`.`CORRIDA` DESC;")
  rs = dbSendQuery(con, query);
  df = fetch(rs, -1);
  dbDisconnect(con)
  return(df)
}


aa <- metadataSeq(mindate = '2022-01-01', maxdate = '2022-02-15')
